#!/usr/bin/env ruby
# frozen_string_literal: true

require 'bundler/setup'
require 'fileutils'

puts 'Builds Documentation Site'

raise 'Git not installed.' unless system 'which git' ## replace this w/ better method

## Needs a check to see if it's in the right git directory.

git_repo_path = `git config --get remote.origin.url`.chomp
unless ARGF.argv.include?('--force')
  unless git_repo_path == 'git@github.com:USSBA/certify-design-system-documentation.git'
    raise 'Wrong Repository.'
  end
end

FileUtils.remove_dir '_site' if Dir.exists? '_site'
if system('bundle', 'exec', 'jekyll', 'build', '--quiet', '--trace')
  FileUtils.cd('_site') do
    unless
      system('git', 'init') &&
      system('git', 'remote', 'add', 'origin', git_repo_path) &&
      system('git', 'checkout', '-b', 'gh-pages') &&
      system('git', 'add', '-A') &&
      system('git', 'commit', '-m', '"update site"') &&
      system('git', 'push', '-f', 'origin', 'gh-pages')
      raise 'unable to push to github'
    end
  end
  FileUtils.remove_dir '_site' if Dir.exists? '_site'
else
  puts 'Something went wrong unable to jekyll build'
end
